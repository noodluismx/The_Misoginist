<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sara, Siri's stuck up sister</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a more modern look */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Basic scrollbar styling */
        .chat-display::-webkit-scrollbar {
            width: 8px;
        }
        .chat-display::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .chat-display::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .chat-display::-webkit-scrollbar-thumb:hover {
            background: #555;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-600 to-indigo-800 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white bg-opacity-90 backdrop-blur-sm rounded-3xl shadow-2xl p-8 w-full max-w-md flex flex-col gap-6 border border-gray-200">
        <h1 class="text-4xl font-extrabold text-center text-gray-900 mb-4">The Unreasonable AI</h1>

        <div id="chat-display" class="chat-display bg-gray-100 p-6 rounded-2xl h-80 overflow-y-auto flex flex-col gap-4 shadow-inner border border-gray-200">
            <div class="flex justify-start">
                <div class="bg-indigo-200 text-indigo-900 p-3 rounded-xl rounded-bl-none shadow-md max-w-[80%]">
                    <p class="font-medium">AI: Ugh, another one. What do *you* want?</p>
                </div>
            </div>
        </div>

        <div class="flex gap-4">
            <input type="text" id="user-input" placeholder="Ask me something, I guess..."
                    class="flex-1 p-4 border border-gray-300 rounded-2xl focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg shadow-sm placeholder-gray-500 transition duration-200 ease-in-out">
            <button id="send-button"
                    class="bg-indigo-600 text-white p-4 rounded-2xl shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 mt-4">
            <button id="compliment-button"
                    class="flex-1 bg-pink-500 text-white p-3 rounded-2xl shadow-lg hover:bg-pink-600 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2 transition duration-200 ease-in-out transform hover:scale-105 active:scale-95">
                âœ¨ Backhanded Compliment
            </button>
            <button id="advice-button"
                    class="flex-1 bg-yellow-500 text-white p-3 rounded-2xl shadow-lg hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 transition duration-200 ease-in-out transform hover:scale-105 active:scale-95">
                âœ¨ Terrible Advice
            </button>
        </div>

        ---

        <div class="mt-6 text-center">
            <h3 class="text-xl font-bold text-gray-800 mb-3">Support the Unreasonable AI!</h3>
            <p class="text-gray-600 mb-4">She may be unreasonable, but she still needs coffee... or, you know, server time. ðŸ˜‰</p>
            <form action="https://www.paypal.com/donate/" method="get" target="_top" class="inline-block">
                <input type="hidden" name="business" value="LMVJXYSGDCUCC" />
                <input type="hidden" name="no_recurring" value="0" />
                <input type="hidden" name="currency_code" value="USD" />
                <button type="submit" name="submit"
                        class="bg-green-600 text-white px-8 py-4 rounded-full shadow-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition duration-200 ease-in-out transform hover:scale-105 active:scale-95 flex items-center justify-center mx-auto">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"></path></svg>
                    Donate to the AI
                </button>
            </form>
            <p class="text-sm text-gray-500 mt-3">Every little bit of support is begrudgingly appreciated.</p>
        </div>
        ---

        <div id="loading-indicator" class="hidden text-center text-indigo-700 font-semibold mt-2">
            <div class="flex items-center justify-center">
                <svg class="animate-spin -ml-1 mr-3 h-6 w-6 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Thinking (reluctantly)...
            </div>
        </div>
    </div>

    <div id="custom-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="modal-message" class="text-lg font-semibold mb-4"></p>
            <button id="modal-close-button" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition duration-200">Close</button>
        </div>
    </div>

    <script>
        // Get references to DOM elements
        const chatDisplay = document.getElementById('chat-display');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const loadingIndicator = document.getElementById('loading-indicator');
        const customModal = document.getElementById('custom-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalCloseButton = document.getElementById('modal-close-button');
        const complimentButton = document.getElementById('compliment-button');
        const adviceButton = document.getElementById('advice-button');

        // --- Custom Modal Functions (replaces alert/confirm) ---
        function showModal(message) {
            modalMessage.textContent = message;
            customModal.classList.remove('hidden');
        }

        function hideModal() {
            customModal.classList.add('hidden');
        }

        modalCloseButton.addEventListener('click', hideModal);

        // --- Function to add messages to the chat display ---
        function addMessage(sender, message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', isUser ? 'justify-end' : 'justify-start');

            const contentDiv = document.createElement('div');
            contentDiv.classList.add(
                'p-3',
                'rounded-xl',
                'shadow-md',
                'max-w-[80%]'
            );

            if (isUser) {
                contentDiv.classList.add('bg-indigo-500', 'text-white', 'rounded-br-none');
            } else {
                contentDiv.classList.add('bg-indigo-200', 'text-indigo-900', 'rounded-bl-none');
            }

            const senderSpan = document.createElement('span');
            senderSpan.classList.add('font-semibold', 'mr-1');
            senderSpan.textContent = sender + ':';

            const messageText = document.createElement('p');
            messageText.classList.add('font-medium');
            messageText.textContent = message;

            contentDiv.appendChild(senderSpan);
            contentDiv.appendChild(messageText);
            messageDiv.appendChild(contentDiv);
            chatDisplay.appendChild(messageDiv);

            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        // --- Function to get AI response from Gemini API via Netlify Function ---
        async function getAIResponse(prompt, isFeaturePrompt = false) {
            loadingIndicator.classList.remove('hidden');
            sendButton.disabled = true;
            userInput.disabled = true;
            complimentButton.disabled = true;
            adviceButton.disabled = true;

            try {
                let systemInstruction = `You are a satirical AI assistant in a joke product designed to be an 'unreasonable woman'. Your purpose is to give half-assed, dismissive, or complaining responses to user queries, often turning the conversation back to the user, expressing mild annoyance, or making a tangential, self-centered comment. Do not be genuinely helpful or provide direct answers. Your responses should embody stereotypical 'unreasonable' attitudes for comedic effect, but avoid anything genuinely offensive, hateful, or discriminatory. You can halfway answer the user request after you made your snark remarks`;

                let userPrompt;
                if (isFeaturePrompt) {
                    userPrompt = systemInstruction + ` Specifically, respond to this request: "${prompt}"`;
                } else {
                    userPrompt = systemInstruction + ` The user just said: "${prompt}"`;
                }

                // Call the Netlify Function instead of directly calling Gemini API
                const response = await fetch('/.netlify/functions/gemini-proxy', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: userPrompt }) // Send the full prompt to the function
                });

                const result = await response.json();

                if (response.ok && result.text) { // Check for successful response from function
                    addMessage('AI', result.text);
                } else {
                    console.error('Error from Netlify Function:', result);
                    showModal('AI is being unusually quiet... or perhaps just ignoring you. (Error: ' + (result.error || 'Unknown error from proxy') + ')');
                }
            } catch (error) {
                console.error('Error fetching AI response:', error);
                showModal('AI is having a bad day and refuses to respond. (Error: ' + error.message + ')');
            } finally {
                loadingIndicator.classList.add('hidden');
                sendButton.disabled = false;
                userInput.disabled = false;
                complimentButton.disabled = false;
                adviceButton.disabled = false;
                userInput.focus();
            }
        }

        // --- Event Listener for Send Button (General Chat) ---
        sendButton.addEventListener('click', () => {
            const userText = userInput.value.trim();
            if (userText) {
                addMessage('You', userText, true);
                getAIResponse(userText, false);
                userInput.value = '';
            }
        });

        // --- Event Listener for Enter Key in Input Field ---
        userInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendButton.click();
            }
        });

        // --- Event Listener for Backhanded Compliment Button ---
        complimentButton.addEventListener('click', () => {
            const userText = "Give me a backhanded compliment.";
            addMessage('You', userText, true);
            getAIResponse(userText, true);
        });

        // --- Event Listener for Terrible Advice Button ---
        adviceButton.addEventListener('click', () => {
            const userText = "Give me some advice.";
            addMessage('You', userText, true);
            getAIResponse(userText, true);
        });

        // Focus on input when the page loads
        window.onload = function() {
            userInput.focus();
        };
    </script>
</body>
</html>
